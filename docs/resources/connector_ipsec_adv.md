---
page_title: "alkira_connector_ipsec_adv Resource - terraform-provider-alkira"
subcategory: ""
description: |-
  Manage Advanced IPSec Connector. (BETA)
---

# alkira_connector_ipsec_adv (Resource)

Manage Advanced IPSec Connector. (**BETA**)

## Overlay IP Addresses

The overlay IP address of the customer end of the tunnel can be
provided as an input when the IP address to be used does not fit into
the ranges available with IP reservation.

When the overlay IP address is povided, it MUST NOT overlap the
following blocks:

* The IP Blocks of the segment
* The Link Local block (`169.254.0.0/16`)
* The Multicast Block (`224.0.0.0/4`)
* The Broadcast Block (`255.255.255.255/32`)
* The Loopback Block (`127.0.0.0/8`)

Also when the overlay IP address is provided, the overlay IP
reservation used on the Alkira side MUST be for a `/32` address

## IPSec Tunnel Advanced Options

To set `advanced_options` of the `tunnel`, The IPSec Tunnel Profile
(resource `alkira_connector_ipsec_tunnel_profile`) is mandatory.


## Example Usage

```terraform
resource "alkira_connector_ipsec_adv" "test" {
  name       = "test"
  segment_id = alkira_segment.test.id
  cxp        = "US-EAST"
  size       = "SMALL"
  vpn_mode   = "ROUTE_BASED"
  enabled    = true

  advertise_default_route  = false
  advertise_on_prem_routes = false
  tunnels_per_gateway      = 1

  gateway {
    name                = "site1"
    customer_gateway_ip = "xx.xxx.xxx.xxx"
    ha_mode             = "ACTIVE"

    tunnel {
      number        = 1
      preshared_key = "1234"

      customer_end_overlay_ip_reservation_id = "151e8723-xxxx-4d6d-be90-xxxxxxxxxxxx"
      cxp_end_overlay_ip_reservation_id      = "151e8723-xxxx-4d6d-be90-xxxxxxxxxxxx"
      cxp_end_public_ip_reservation_id       = "f9f05b7a-xxxx-48eb-93e2-xxxxxxxxxxxx"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cxp` (String) The CXP where the connector should be provisioned.
- `gateway` (Block List, Min: 1) The gateway. (see [below for nested schema](#nestedblock--gateway))
- `name` (String) The name of the connector.
- `segment_id` (String) The ID of the segment associated with the connector.
- `size` (String) The size of the connector, one of `SMALL`, `MEDIUM`, `LARGE`, `2LARGE`, `4LARGE`, `5LARGE`, `10LARGE` and `20LARGE`.

### Optional

- `advertise_default_route` (Boolean) Enable or disable access to the internet when traffic arrives via this connector. Default is `false`.
- `advertise_on_prem_routes` (Boolean) Additional options for each segment associated with the connector. Default is `false`.
- `billing_tag_ids` (Set of Number) A list of IDs of billing tag associated with the gateway.
- `destination_type` (String) The destination type of the connector. The value could be `IPSEC_ENDPOINT`, `AWS_VPN_CONNECTION`, `AZURE_VPN_CONNECTION`. The default value is `IPSEC_ENDPOINT`.
- `enabled` (Boolean) Is the connector enabled. Default is `true`.
- `group` (String) The group of the connector.
- `policy_options` (Block Set) Policy options, both `on_prem_prefix_list_ids` and `cxp_prefix_list_ids` must be provided if `vpn_mode` is `POLICY_BASED` (see [below for nested schema](#nestedblock--policy_options))
- `routing_options` (Block Set) Routing options, type is `STATIC`, `DYNAMIC`, or`BOTH` must be provided if `vpn_mode` is `ROUTE_BASED` (see [below for nested schema](#nestedblock--routing_options))
- `tunnels_per_gateway` (Number) The number of tunnels per gateway instance. Default is `1`.
- `vpn_mode` (String) The VPN mode could be only set to `ROUTE_BASED` for now.

### Read-Only

- `id` (String) The ID of this resource.
- `implicit_group_id` (Number) The ID of implicit group automaticaly created with the connector.
- `provision_state` (String) The provision state of the connector.

<a id="nestedblock--gateway"></a>
### Nested Schema for `gateway`

Required:

- `customer_gateway_ip` (String) The IP address of the customer gateway. This should be `0.0.0.0` to indicate that this is a dynamic gateway.
- `name` (String) The name of the endpoint.
- `tunnel` (Block List, Min: 1) Tunnel of the gateway. The number of the tunnels should be equal to `tunnel_per_gateway`. (see [below for nested schema](#nestedblock--gateway--tunnel))

Optional:

- `ha_mode` (String) The value could be `ACTIVE` or`STANDBY`. A gateway in `STANDBY` mode will not be used for traffic unless all other gateways for the connector are down. There can only be one gateway in `STANDBY` mode per connector and there must be at least one gateway that isn't in `STANDBY` mode per connector.

Read-Only:

- `id` (Number) The ID of the gateway.

<a id="nestedblock--gateway--tunnel"></a>
### Nested Schema for `gateway.tunnel`

Required:

- `customer_end_overlay_ip_reservation_id` (String) The overlay IP reservation ID of the customer end of the tunnel.
- `cxp_end_overlay_ip_reservation_id` (String) The overlay IP reservation ID of the CXP end of the tunnel.
- `cxp_end_public_ip_reservation_id` (String) The public IP reservation ID of the CXP end of the tunnel.
- `preshared_key` (String) The pre-shared key of the tunnel.

Optional:

- `advanced_options` (Block List, Max: 1) Advanced options for the IPSec gateway. (see [below for nested schema](#nestedblock--gateway--tunnel--advanced_options))
- `profile_id` (Number) The ID of the IPSec Tunnel Profile (`connector_ipsec_tunnel_profile`). `advanced_options` block is required when this is used.

Read-Only:

- `customer_end_overlay_ip` (String) The overlay IP address of the customer end of the tunnel.
- `id` (String) The ID of the tunnel.
- `number` (Number) The number of the tunnel.

<a id="nestedblock--gateway--tunnel--advanced_options"></a>
### Nested Schema for `gateway.tunnel.advanced_options`

Required:

- `ike_version` (String) IKE version, either `IKEv1` or `IKEv2`
- `initiator` (Boolean) When true CXP will initiate the IKE connection and if false then the customer gateway should initiate IKE. When `gateway_ip_type` is `DYNAMIC`,initiator must be `true`.
- `remote_auth_type` (String) Remote-ID type - IKE identity to use for authentication round, one of `FQDN`, `USER_FQDN`, `KEYID`, `IP_ADDR`.
- `remote_auth_value` (String) Remote-ID value.




<a id="nestedblock--policy_options"></a>
### Nested Schema for `policy_options`

Required:

- `cxp_prefix_list_ids` (Set of Number) CXP Prefix List IDs.
- `on_prem_prefix_list_ids` (Set of Number) On-Prem Prefix List IDs.


<a id="nestedblock--routing_options"></a>
### Nested Schema for `routing_options`

Required:

- `type` (String) Routing type, one of `STATIC`, `DYNAMIC`, or `BOTH`.

Optional:

- `availability` (String) The method to determine the availability of the routes. The value could be `IKE_STATUS` or `IPSEC_INTERFACE_PING`. Default value is `IPSEC_INTERFACE_PING`.
- `bgp_auth_key` (String) BGP MD5 auth key for Alkira to authenticate Alkira CXP (On Premise Gateway).
- `customer_gateway_asn` (String) The customer gateway ASN to use for dynamic route propagation.
- `prefix_list_id` (Number) The ID of prefix list to use for static route propagation.

## Import

Import is supported using the following syntax:

```shell
terraform import alkira_connector_ipsec_adv.example CONNECTOR_ID
```
