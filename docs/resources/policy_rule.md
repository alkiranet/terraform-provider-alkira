---
page_title: "alkira_policy_rule Resource - terraform-provider-alkira"
subcategory: ""
description: |-
  Manage policy rule.
  This resource is usually used along with policy resources:policy_prefix_list, policy_rule_list and policycontrol the network traffic.
---

# alkira_policy_rule (Resource)

Manage policy rule.

This resource is usually used along with policy resources:`policy_prefix_list`, `policy_rule_list` and `policy`control the network traffic.

## Example Usage

Simple example of a DROP rule.

```terraform
# Basic Policy Rule Example
resource "alkira_policy_rule" "basic" {
  name          = "basic-drop-rule"
  description   = "Basic policy rule to drop traffic"
  src_ip        = "any"
  dst_ip        = "172.16.0.0/16"
  dscp          = "any"
  protocol      = "any"
  src_ports     = ["any"]
  dst_ports     = ["any"]
  rule_action   = "DROP"
}

# Advanced Policy Rule with Prefix Lists
resource "alkira_policy_rule" "advanced" {
  name                  = "advanced-service-rule"
  description           = "Advanced policy rule with service chaining"
  src_prefix_list_id    = alkira_policy_prefix_list.internal_networks.id
  dst_prefix_list_id    = alkira_policy_prefix_list.dmz_networks.id
  dscp                  = "any"
  protocol              = "tcp"
  src_ports             = ["any"]
  dst_ports             = ["80", "443"]
  rule_action           = "ALLOW"

  # Service chaining
  rule_action_service_types = ["FIREWALL", "IDS"]
  rule_action_service_ids   = [alkira_service_pan.firewall.id, alkira_service_checkpoint.ids.id]

  # Flow collection
  rule_action_flow_collector_ids = [alkira_flow_collector.security.id]
}

# Policy Rule with Internet Application
resource "alkira_policy_rule" "internet_app" {
  name                    = "internet-app-rule"
  description             = "Policy rule for internet application access"
  src_ip                  = "10.0.0.0/8"
  internet_application_id = alkira_internet_application.office365.id
  dscp                    = "any"
  protocol                = "tcp"
  src_ports               = ["any"]
  dst_ports               = ["443"]
  rule_action             = "ALLOW"
}

# Policy Rule with Application IDs
resource "alkira_policy_rule" "application_based" {
  name           = "application-based-rule"
  description    = "Policy rule based on application identification"
  src_ip         = "any"
  dst_ip         = "any"
  dscp           = "any"
  protocol       = "any"
  src_ports      = ["any"]
  dst_ports      = ["any"]
  application_ids = ["HTTP", "HTTPS", "SSH"]
  rule_action    = "ALLOW"

  # Route through security services
  rule_action_service_types = ["FIREWALL"]
  rule_action_service_ids   = [alkira_service_pan.firewall.id]
}
```

To configure service chaining, multiple service types can be
selected. Service chaining is currently supported only with PAN and
Zscaler services.

```terraform
resource "alkira_policy_rule" "rule" {
  name          = "test-rule"
  description   = "Test Rule"
  src_ip        = "any"
  dst_ip        = "172.16.0.0/16"
  dscp          = "any"
  protocol      = "any"
  src_ports     = ["any"]
  dst_ports     = ["any"]
  rule_action   = "ALLOW"
  rule_action_service_types = ["PAN","ZIA"]
}
```

Another example of service chaining. The order of the services is
important and PAN services must be followed by Zscaler services. In
the below example, 1 & 2 are PAN serviceIds where as 3 is a Zscaler
serviceId.

```terraform
resource "alkira_policy_rule" "rule" {
  name          = "test-rule"
  description   = "Test Rule"
  src_ip        = "any"
  dst_ip        = "172.16.0.0/16"
  dscp          = "any"
  protocol      = "any"
  src_ports     = ["any"]
  dst_ports     = ["any"]
  rule_action   = "ALLOW"
  rule_action_service_ids = [1,2,3]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `dscp` (String) The dscp value can be `any` or between `0` to `63` inclusive.
- `name` (String) The name of the policy rule.
- `protocol` (String) The following protocols are supported, `icmp`, `tcp`, `udp` or `any`.

### Optional

- `application_ids` (Set of Number)
- `description` (String) The description of the policy rule.
- `dst_ip` (String) A single destination IP as The match condition of the rule.
- `dst_ports` (List of String) Destination ports that can take values: `any` or `1` to `65535`.
- `dst_prefix_list_id` (Number) The ID of prefix list as destination associated with the rule.
- `internet_application_id` (Number) The ID of the `internet_application` associated with the rule. When an internet applciation is selected, destination IP and port will be the private IP and port of the application.
- `rule_action` (String) The action that is applied on matched traffic, either `ALLOW` or `DROP`. The default value is `ALLOW`.
- `rule_action_flow_collector_ids` (Set of Number) Based on the flow collector IDs, flows observed would be collected and sent to configured destination.
- `rule_action_service_ids` (List of Number) Based on the service IDs, traffic is routed to the specified services. For service chaining, both `service_pan` and `service_zscaler`'s IDs can be added here, but ID of `service_pan` must be by followed by ID of `service_zscaler`.
- `rule_action_service_types` (List of String) Based on the service type, traffic is routed to service of the given type. For service chaining, both PAN and ZIA service types can be selected but must follow order.
- `src_ip` (String) A single source IP as The match condition of the rule.
- `src_ports` (List of String) Source ports that can take values: `any` or `1` to `65535`.
- `src_prefix_list_id` (Number) The ID of prefix list as source associated with the rule.

### Read-Only

- `id` (String) The ID of this resource.
- `provision_state` (String) The provision state of the resource.

## Import

Import is supported using the following syntax:

```shell
terraform import alkira_policy_rule.example RULE_ID
```
